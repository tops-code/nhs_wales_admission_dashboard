<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Admissions in NHS Wales</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="app_files/libs/clipboard/clipboard.min.js"></script>
<script src="app_files/libs/quarto-html/quarto.js"></script>
<script src="app_files/libs/quarto-html/popper.min.js"></script>
<script src="app_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="app_files/libs/quarto-html/anchor.min.js"></script>
<link href="app_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="app_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="app_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="app_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="app_files/libs/bootstrap/bootstrap-71160c0a3a840f62b312b3ca4425d988.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="app_files/libs/quarto-dashboard/quarto-dashboard.js"></script>
<script src="app_files/libs/quarto-dashboard/stickythead.js"></script>
<script src="app_files/libs/quarto-dashboard/datatables.min.js" kdttablesentinel="true"></script>
<script src="app_files/libs/quarto-dashboard/pdfmake.min.js" kdttablesentinel="true"></script>
<script src="app_files/libs/quarto-dashboard/vfs_fonts.js" kdttablesentinel="true"></script>
<script src="app_files/libs/quarto-dashboard/web-components.js" type="module"></script>
<script src="app_files/libs/quarto-dashboard/components.js"></script>
<link href="app_files/libs/quarto-dashboard/datatables.min.css" rel="stylesheet" kdttablesentinel="true">


</head>

<body class="quarto-dashboard dashboard-fill dashboard-sidebar fullcontent">

<header id="quarto-dashboard-header">
<nav class="navbar navbar-expand-md slim" data-bs-theme="dark">
  <div class="navbar-container container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#dashboard-collapse" aria-controls="dashboard-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>    


    <div class="navbar-brand-container">       
    <a href="#"><img src="theme/NHS_Wales_logo.svg.png" alt="" class="navbar-logo d-inline-block"></a>
      <div class="navbar-title">
        <div class="navbar-title-text"><a href="#">Admissions in NHS Wales</a></div>
        
        
      </div>
    </div>
<div id="dashboard-collapse" class="navbar-collapse collapse"><ul class="navbar-nav navbar-nav-scroll me-auto" role="tablist"><li class="nav-item" role="presentation"><a id="tab-summary" class="nav-link active" data-bs-toggle="tab" role="tab" data-bs-target="#summary" data-scrolling="false" href="#summary" aria-controls="summary" aria-selected="true"><span class="nav-link-text">Summary</span></a></li><li class="nav-item" role="presentation"><a id="tab-comparison" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#comparison" data-scrolling="false" href="#comparison" aria-controls="comparison" aria-selected="false"><span class="nav-link-text">Comparison</span></a></li></ul><div class="quarto-dashboard-links"><a class="quarto-dashboard-link" href="https://x.com/_togbonna"><i class="bi bi-twitter"></i></a><a class="quarto-dashboard-link" href="https://www.linkedin.com/in/toochukwu-ogbonna-939266207/"><i class="bi bi-linkedin"></i></a><a class="quarto-dashboard-link" href="https://github.com/tops-code"><i class="bi bi-gitlab"></i></a></div></div></div>
</nav>
</header>
<div class="page-layout-custom quarto-dashboard-content bslib-gap-spacing html-fill-container bslib-page-fill quarto-dashboard-pages dashboard-sidebar-container">  

<div class="bslib-sidebar-layout html-fill-item html-fill-container" data-bslib-sidebar-open="desktop" data-bslib-sidebar-init="true" data-bslib-sidebar-border="false" data-bslib-sidebar-border-radius="false"><div class="main html-fill-container html-fill-item"><div class="sidebar-content html-fill-item html-fill-container">
<div class="tab-content bslib-grid html-fill-item html-fill-container" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div id="summary" class="dashboard-page tab-pane show active html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-summary">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, max-content) minmax(3em, 70fr) minmax(3em, 70fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr) minmax(3em, 1fr) minmax(3em, 1fr) minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card bslib-card bslib-mb-spacing html-fill-item html-fill-container bslib-value-box bg-teal showcase-top-right" data-bslib-card-init="" data-require-bs-caller="card()" data-require-bs-version="5 5" data-full-screen="false">
<div class="card-body bslib-gap-spacing html-fill-item html-fill-container" style="margin-top:auto;margin-bottom:auto;flex:1 1 auto; padding:0;">
<div class="value-box-grid html-fill-item" style="--bslib-grid-height:auto;--bslib-grid-height-mobile:auto;---bslib-value-box-showcase-w:40%;---bslib-value-box-showcase-w-fs:1fr;---bslib-value-box-showcase-max-h:75px;---bslib-value-box-showcase-max-h-fs:67%;">
<div class="value-box-showcase html-fill-item html-fill-container"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-hospital " style="height:1em;width:1em;fill:currentColor;vertical-align:-0.125em;" aria-hidden="true" role="img"><path d="M8.5 5.034v1.1l.953-.55.5.867L9 7l.953.55-.5.866-.953-.55v1.1h-1v-1.1l-.953.55-.5-.866L7 7l-.953-.55.5-.866.953.55v-1.1h1ZM13.25 9a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM13 11.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Zm.25 1.75a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5Zm-11-4a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 3 9.75v-.5A.25.25 0 0 0 2.75 9h-.5Zm0 2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM2 13.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Z"></path>
<path d="M5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1a1 1 0 0 1 1 1v4h3a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h3V3a1 1 0 0 1 1-1V1Zm2 14h2v-3H7v3Zm3 0h1V3H5v12h1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3Zm0-14H6v1h4V1Zm2 7v7h3V8h-3Zm-8 7V8H1v7h3Z"></path></svg></div>
<div class="value-box-area html-fill-item html-fill-container">
<p class="value-box-title">Finished Consultant Episodes</p>
<div class="shiny-text-output value-box-value" id="cosult"></div>
</div>
</div>
</div>
<script data-bslib-card-init="">bslib.Card.initializeAllCards();</script>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div><div class="card bslib-card bslib-mb-spacing html-fill-item html-fill-container bslib-value-box bg-pink showcase-top-right" data-bslib-card-init="" data-require-bs-caller="card()" data-require-bs-version="5 5" data-full-screen="false">
<div class="card-body bslib-gap-spacing html-fill-item html-fill-container" style="margin-top:auto;margin-bottom:auto;flex:1 1 auto; padding:0;">
<div class="value-box-grid html-fill-item" style="--bslib-grid-height:auto;--bslib-grid-height-mobile:auto;---bslib-value-box-showcase-w:40%;---bslib-value-box-showcase-w-fs:1fr;---bslib-value-box-showcase-max-h:75px;---bslib-value-box-showcase-max-h-fs:67%;">
<div class="value-box-showcase html-fill-item html-fill-container"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-hospital " style="height:1em;width:1em;fill:currentColor;vertical-align:-0.125em;" aria-hidden="true" role="img"><path d="M8.5 5.034v1.1l.953-.55.5.867L9 7l.953.55-.5.866-.953-.55v1.1h-1v-1.1l-.953.55-.5-.866L7 7l-.953-.55.5-.866.953.55v-1.1h1ZM13.25 9a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM13 11.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Zm.25 1.75a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5Zm-11-4a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 3 9.75v-.5A.25.25 0 0 0 2.75 9h-.5Zm0 2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM2 13.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Z"></path>
<path d="M5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1a1 1 0 0 1 1 1v4h3a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h3V3a1 1 0 0 1 1-1V1Zm2 14h2v-3H7v3Zm3 0h1V3H5v12h1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3Zm0-14H6v1h4V1Zm2 7v7h3V8h-3Zm-8 7V8H1v7h3Z"></path></svg></div>
<div class="value-box-area html-fill-item html-fill-container">
<p class="value-box-title">Number of Admissions</p>
<div class="shiny-text-output value-box-value" id="Admissions"></div>
</div>
</div>
</div>
<script data-bslib-card-init="">bslib.Card.initializeAllCards();</script>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div><div class="card bslib-card bslib-mb-spacing html-fill-item html-fill-container bslib-value-box bg-blue showcase-top-right" data-bslib-card-init="" data-require-bs-caller="card()" data-require-bs-version="5 5" data-full-screen="false">
<div class="card-body bslib-gap-spacing html-fill-item html-fill-container" style="margin-top:auto;margin-bottom:auto;flex:1 1 auto; padding:0;">
<div class="value-box-grid html-fill-item" style="--bslib-grid-height:auto;--bslib-grid-height-mobile:auto;---bslib-value-box-showcase-w:40%;---bslib-value-box-showcase-w-fs:1fr;---bslib-value-box-showcase-max-h:75px;---bslib-value-box-showcase-max-h-fs:67%;">
<div class="value-box-showcase html-fill-item html-fill-container"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-hospital " style="height:1em;width:1em;fill:currentColor;vertical-align:-0.125em;" aria-hidden="true" role="img"><path d="M8.5 5.034v1.1l.953-.55.5.867L9 7l.953.55-.5.866-.953-.55v1.1h-1v-1.1l-.953.55-.5-.866L7 7l-.953-.55.5-.866.953.55v-1.1h1ZM13.25 9a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM13 11.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Zm.25 1.75a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5Zm-11-4a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 3 9.75v-.5A.25.25 0 0 0 2.75 9h-.5Zm0 2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM2 13.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Z"></path>
<path d="M5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1a1 1 0 0 1 1 1v4h3a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h3V3a1 1 0 0 1 1-1V1Zm2 14h2v-3H7v3Zm3 0h1V3H5v12h1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3Zm0-14H6v1h4V1Zm2 7v7h3V8h-3Zm-8 7V8H1v7h3Z"></path></svg></div>
<div class="value-box-area html-fill-item html-fill-container">
<p class="value-box-title">Mean Length of Stay</p>
<div class="shiny-text-output value-box-value" id="stay"></div>
</div>
</div>
</div>
<script data-bslib-card-init="">bslib.Card.initializeAllCards();</script>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div><div class="card bslib-card bslib-mb-spacing html-fill-item html-fill-container bslib-value-box bg-blue showcase-top-right" data-bslib-card-init="" data-require-bs-caller="card()" data-require-bs-version="5 5" data-full-screen="false">
<div class="card-body bslib-gap-spacing html-fill-item html-fill-container" style="margin-top:auto;margin-bottom:auto;flex:1 1 auto; padding:0;">
<div class="value-box-grid html-fill-item" style="--bslib-grid-height:auto;--bslib-grid-height-mobile:auto;---bslib-value-box-showcase-w:40%;---bslib-value-box-showcase-w-fs:1fr;---bslib-value-box-showcase-max-h:75px;---bslib-value-box-showcase-max-h-fs:67%;">
<div class="value-box-showcase html-fill-item html-fill-container"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-hospital " style="height:1em;width:1em;fill:currentColor;vertical-align:-0.125em;" aria-hidden="true" role="img"><path d="M8.5 5.034v1.1l.953-.55.5.867L9 7l.953.55-.5.866-.953-.55v1.1h-1v-1.1l-.953.55-.5-.866L7 7l-.953-.55.5-.866.953.55v-1.1h1ZM13.25 9a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM13 11.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Zm.25 1.75a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5Zm-11-4a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 3 9.75v-.5A.25.25 0 0 0 2.75 9h-.5Zm0 2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM2 13.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Z"></path>
<path d="M5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1a1 1 0 0 1 1 1v4h3a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h3V3a1 1 0 0 1 1-1V1Zm2 14h2v-3H7v3Zm3 0h1V3H5v12h1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3Zm0-14H6v1h4V1Zm2 7v7h3V8h-3Zm-8 7V8H1v7h3Z"></path></svg></div>
<div class="value-box-area html-fill-item html-fill-container">
<p class="value-box-title">Emergency</p>
<div class="shiny-text-output value-box-value" id="emergency"></div>
</div>
</div>
</div>
<script data-bslib-card-init="">bslib.Card.initializeAllCards();</script>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 40fr) minmax(3em, 60fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, max-content); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<p>üè• <strong>Key Concepts</strong></p>
<p>‚öïÔ∏è <strong>Resident / Provider status</strong></p>
<ul>
<li><p>Provider-based figures: Include all patient episodes treated in Welsh hospitals, regardless of where the patient lives.</p></li>
<li><p>Resident-based figures: Include all Welsh residents, whether treated in Wales or England. May contain codes not used in Wales until April 2016.</p></li>
</ul>
<p>‚öïÔ∏è <strong>Disease Type</strong></p>
<ul>
<li><p>Internal/Primary: These are conditions that arise from within the body, often due to physiological, genetic, or infectious processes</p></li>
<li><p>External: external causes of injury, poisoning, and certain other consequence.</p></li>
</ul>
<p>üìÖ Time</p>
<ul>
<li>Year: NHS financial year (April 1 ‚Äì March 31 2023).</li>
</ul>
<p>üìå <strong>Episode Types</strong></p>
<ul>
<li><p>FCEs (Finished Consultant Episodes):</p></li>
<li><p>Time a patient spends under continuous care of one consultant.</p></li>
<li><p>Includes inpatient, day case, and maternity consultant episodes.</p></li>
</ul>
<p>üìå <strong>Admissions (Admission Episodes)</strong>:</p>
<p>First episode in a patient‚Äôs spell of care.</p>
<p>üë• <strong>Demographics</strong></p>
<ul>
<li><p>Male/Female: FCEs by patient sex. Unknown/unspecified sex included in totals.</p></li>
<li><p>Age Groups: Breakdown of Admission by age group.</p></li>
<li><p>Mean Age: Average age at episode start.</p></li>
</ul>
<p>üöë <strong>Admission Method</strong></p>
<ul>
<li>Emergency: Admissions via emergency.</li>
</ul>
<p>üöë Length of Stay (mean):</p>
<ul>
<li><p>Inpatient spells only.</p></li>
<li><p>Calculated from admission ‚Üí discharge.</p></li>
</ul>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-title="Top 5" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Top 5
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="top" style="width:100%;height:400px;"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr) minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card tabset html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header bslib-navs-card-title"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">

</span></div><ul class="nav nav-tabs card-header-tabs" role="tablist" data-tabsetid="card-tabset-7"><li class="nav-item" role="presentation"><a href="#card-tabset-7-1" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Male" aria-selected="true" class="nav-link active">Male</a></li><li class="nav-item" role="presentation"><a href="#card-tabset-7-2" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Female" aria-selected="false" class="nav-link">Female</a></li></ul></div>


<div class="tab-content html-fill-item html-fill-container" data-tabset-id="card-tabset-7"><div class="tab-pane active show html-fill-item html-fill-container" role="tabpanel" id="card-tabset-7-1"><div class="card-body html-fill-item html-fill-container" data-title="Male">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="male" style="width:100%;height:400px;"></div>
</div>
</div></div><div class="tab-pane html-fill-item html-fill-container" role="tabpanel" id="card-tabset-7-2"><div class="card-body html-fill-item html-fill-container" data-title="Female">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="female" style="width:100%;height:400px;"></div>
</div>
</div></div></div><bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div><div class="card tabset html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header bslib-navs-card-title"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">

</span></div><ul class="nav nav-tabs card-header-tabs" role="tablist" data-tabsetid="card-tabset-8"><li class="nav-item" role="presentation"><a href="#card-tabset-8-1" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Age 0-14" aria-selected="true" class="nav-link active">Age 0-14</a></li><li class="nav-item" role="presentation"><a href="#card-tabset-8-2" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Age 15-59&quot;" aria-selected="false" class="nav-link">Age 15-59"</a></li><li class="nav-item" role="presentation"><a href="#card-tabset-8-3" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Age 60-74" aria-selected="false" class="nav-link">Age 60-74</a></li><li class="nav-item" role="presentation"><a href="#card-tabset-8-4" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Age 75+" aria-selected="false" class="nav-link">Age 75+</a></li></ul></div>




<div class="tab-content html-fill-item html-fill-container" data-tabset-id="card-tabset-8"><div class="tab-pane active show html-fill-item html-fill-container" role="tabpanel" id="card-tabset-8-1"><div class="card-body html-fill-item html-fill-container" data-title="Age 0-14">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="fourteen" style="width:100%;height:400px;"></div>
</div>
</div></div><div class="tab-pane html-fill-item html-fill-container" role="tabpanel" id="card-tabset-8-2"><div class="card-body html-fill-item html-fill-container" data-title="Age 15-59&quot;">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="fifteen" style="width:100%;height:400px;"></div>
</div>
</div></div><div class="tab-pane html-fill-item html-fill-container" role="tabpanel" id="card-tabset-8-3"><div class="card-body html-fill-item html-fill-container" data-title="Age 60-74">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="sixty" style="width:100%;height:400px;"></div>
</div>
</div></div><div class="tab-pane html-fill-item html-fill-container" role="tabpanel" id="card-tabset-8-4"><div class="card-body html-fill-item html-fill-container" data-title="Age 75+">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="sevenfive" style="width:100%;height:400px;"></div>
</div>
</div></div></div><bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div><div id="comparison" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-comparison">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, max-content) minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<p>Compare different health boards</p>
<p>This section compares values per 10,000 people, where indicated. Population data is taken from the 2021 Census and reflects the counties served by the different health boards. Using metrics per 10,000 provides a way to move beyond the raw figures and adds context to the numbers.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-title="Comparison" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-element="next" data-target-position="header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Comparison

</span></div>
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="form-group shiny-input-container html-fill-item html-fill-container">
<label class="control-label" id="HealthBoardtwo-label" for="HealthBoardtwo">Select options below:</label>
<div class="html-fill-item html-fill-container">
<select id="HealthBoardtwo" class="shiny-input-select"><option value="Aneurin Bevan University Health Board" selected="">Aneurin Bevan University Health Board</option>
<option value="Betsi Cadwaladr University Health Board">Betsi Cadwaladr University Health Board</option>
<option value="Cardiff and Vale University Health Board">Cardiff and Vale University Health Board</option>
<option value="Cwm Taf Morgannwg University Health Board">Cwm Taf Morgannwg University Health Board</option>
<option value="Hywel Dda University Health Board">Hywel Dda University Health Board</option>
<option value="Powys Teaching Health Board">Powys Teaching Health Board</option>
<option value="Swansea Bay University Health Board">Swansea Bay University Health Board</option></select>
<script type="application/json" data-for="HealthBoardtwo" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="form-group shiny-input-container html-fill-item html-fill-container">
<label class="control-label" id="Diseasetwo-label" for="Diseasetwo">Type of Disease Cause</label>
<div class="html-fill-item html-fill-container">
<select id="Diseasetwo" class="shiny-input-select"><option value="Primary" selected="">Primary</option>
<option value="External">External</option></select>
<script type="application/json" data-for="Diseasetwo" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="form-group shiny-input-container html-fill-item html-fill-container">
<label class="control-label" id="RorPtwo-label" for="RorPtwo">Resident or Provider:</label>
<div class="html-fill-item html-fill-container">
<select id="RorPtwo" class="shiny-input-select"><option value="Health board Resident" selected="">Health board Resident</option>
<option value="Health board Provider">Health board Provider</option></select>
<script type="application/json" data-for="RorPtwo" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
</div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="comparison" style="width:100%;height:400px;"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div><div id="3ade8a4a-fb1d-4a6c-8409-ac45482d5fc9" class="hidden html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
</div>
</div></div><aside id="bslib-sidebar-1" class="sidebar html-fill-container html-fill-item"><div class="html-fill-container html-fill-item">
<p><br></p>
<p>This dashboard displays statistics for Emergecnies in the 7 welsh NHS health boards from the 2023/2024 year.. it gotten from the official NHS Wales data repository. it also gets population data from https://statswales.gov.wales/.</p>
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container">
<label class="control-label" id="HealthBoard-label" for="HealthBoard">Select options below:</label>
<div>
<select id="HealthBoard" class="shiny-input-select"><option value="Aneurin Bevan University Health Board" selected="">Aneurin Bevan University Health Board</option>
<option value="Betsi Cadwaladr University Health Board">Betsi Cadwaladr University Health Board</option>
<option value="Cardiff and Vale University Health Board">Cardiff and Vale University Health Board</option>
<option value="Cwm Taf Morgannwg University Health Board">Cwm Taf Morgannwg University Health Board</option>
<option value="Hywel Dda University Health Board">Hywel Dda University Health Board</option>
<option value="Powys Teaching Health Board">Powys Teaching Health Board</option>
<option value="Swansea Bay University Health Board">Swansea Bay University Health Board</option></select>
<script type="application/json" data-for="HealthBoard" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container">
<label class="control-label" id="Disease-label" for="Disease">Type of Disease Cause</label>
<div>
<select id="Disease" class="shiny-input-select"><option value="Primary" selected="">Primary</option>
<option value="External">External</option></select>
<script type="application/json" data-for="Disease" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container">
<label class="control-label" id="RorP-label" for="RorP">Resident or Provider:</label>
<div>
<select id="RorP" class="shiny-input-select"><option value="Health board Resident" selected="">Health board Resident</option>
<option value="Health board Provider">Health board Provider</option></select>
<script type="application/json" data-for="RorP" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="shiny-panel-conditional" data-display-if="input.Disease == 'Primary'" data-ns-prefix="">
<div class="form-group shiny-input-container">
<label class="control-label" id="category-label" for="category">Category of internal disease</label>
<div>
<select id="category" class="shiny-input-select"><option value="All" selected="">All</option>
<option value="Certain infectious and parasitic diseases">Certain infectious and parasitic diseases</option>
<option value="Neoplasms">Neoplasms</option>
<option value="Diseases of the blood and immune system">Diseases of the blood and immune system</option>
<option value="Endocrine, nutritional and metabolic diseases">Endocrine, nutritional and metabolic diseases</option>
<option value="Mental and behavioural disorders">Mental and behavioural disorders</option>
<option value="Diseases of the nervous system">Diseases of the nervous system</option>
<option value="Diseases of the eye and adnexa">Diseases of the eye and adnexa</option>
<option value="Diseases of the ear and mastoid process">Diseases of the ear and mastoid process</option>
<option value="Diseases of the circulatory system">Diseases of the circulatory system</option>
<option value="Diseases of the respiratory system">Diseases of the respiratory system</option>
<option value="Diseases of the digestive system">Diseases of the digestive system</option>
<option value="Diseases of the skin and subcutaneous tissue">Diseases of the skin and subcutaneous tissue</option>
<option value="Diseases of the musculoskeletal system and connective tissue">Diseases of the musculoskeletal system and connective tissue</option>
<option value="Diseases of the genitourinary system">Diseases of the genitourinary system</option>
<option value="Pregnancy, childbirth and the puerperium">Pregnancy, childbirth and the puerperium</option>
<option value="Certain conditions originating in the perinatal period">Certain conditions originating in the perinatal period</option>
<option value="Congenital malformations, deformations and chromosomal abnormalities">Congenital malformations, deformations and chromosomal abnormalities</option>
<option value="Symptoms, signs and abnormal clinical findings">Symptoms, signs and abnormal clinical findings</option>
<option value="Injury, poisoning and certain other consequences of external causes">Injury, poisoning and certain other consequences of external causes</option>
<option value="Factors influencing health status">Factors influencing health status</option></select>
<script type="application/json" data-for="category" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>While data is not fictional care should be taekn to inpterpret it and its usage. <a href="https://phw.nhs.wales/data/">NHS Data repository</a> <a href="https://statswales.gov.wales/Catalogue/Population-and-Migration/Population/Estimates/Small-Area">Stats Wales Page</a>.</p>
</div>
</div>
</div>
</div></aside>
<button class="collapse-toggle" type="button" title="Toggle sidebar" aria-expanded="true" aria-controls="bslib-sidebar-1">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-chevron-left collapse-icon" style="fill:currentColor;" aria-hidden="true" role="img">
      <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"></path>
    </svg>
</button>
<script data-bslib-sidebar-init="">
bslib.Sidebar.initCollapsibleAll()
</script>
</div>
<p>
<script type="application/shiny-prerendered" data-context="server-start">
library(tidyverse)
library(readxl)
library(DT)
library(gt)
library(shinyWidgets)
library(bslib)
library(bsicons)
library(naniar)
library(here)
library(patchwork)
theme_custom <- function (base_size = 15, base_family = "Atkinson Hyperlegible") {
    half_line <- base_size/2
  theme(
    line = element_blank(),
    rect = element_rect(fill = "#ffffff", color = NA,
                        linewidth = NA, linetype = 1),
    text = element_text(family = base_family, face = "plain",
                        color = "black", size = base_size,
                        lineheight = .9, hjust = .5, vjust = .5,
                        angle = 0, margin = margin(), debug = FALSE),
    axis.line = element_blank(),
    axis.line.x = NULL,
    axis.line.y = NULL,
    axis.text = element_text(size = base_size, color = "gray30"),
    axis.text.x = element_text(size = base_size * 0.5, margin = margin(t = .8 * half_line/2),
                               vjust = 1),
    axis.text.x.top = element_text(margin = margin(b = .8 * half_line/2),
                                   vjust = 0),
    axis.text.y = element_text(margin = margin(r = .8 * half_line/2),
                               hjust = 1),
    axis.text.y.right = element_text(margin = margin(l = .8 * half_line/2),
                                     hjust = 0),
    axis.ticks = element_line(color = "gray30", linewidth = .7),
    axis.ticks.length = unit(half_line / 1.5, "pt"),
    axis.ticks.length.x = NULL,
    axis.ticks.length.x.top = NULL,
    axis.ticks.length.x.bottom = NULL,
    axis.ticks.length.y = NULL,
    axis.ticks.length.y.left = NULL,
    axis.ticks.length.y.right = NULL,
    axis.title.x = element_blank(),
    axis.title.x.top = element_text(margin = margin(b = half_line),
                                    vjust = 0),
    axis.title.y = element_blank(),
    axis.title.y.right = element_text(angle = -90, vjust = 0,
                                      margin = margin(l = half_line)),
    legend.background = element_rect(color = NA),
    legend.spacing = unit(.4, "cm"),
    legend.spacing.x = NULL,
    legend.spacing.y = NULL,
    legend.margin = margin(.2, .2, .2, .2, "cm"),
    legend.key = element_rect(fill = "gray95", color = "white"),
    legend.key.size = unit(1.2, "lines"),
    legend.key.height = NULL,
    legend.key.width = NULL,
    legend.text = element_text(size = rel(.8)),
    legend.text.align = NULL,
    legend.title = element_text(hjust = 0),
    legend.title.align = NULL,
    legend.position = "right",
    legend.direction = NULL,
    legend.justification = "center",
    legend.box = NULL,
    legend.box.margin = margin(0, 0, 0, 0, "cm"),
    legend.box.background = element_blank(),
    legend.box.spacing = unit(.4, "cm"),
    panel.background = element_rect(fill = NA, color = NA),
    panel.border = element_rect(color = NULL,
                                fill = NA, linewidth = NULL),
    panel.grid.major = element_line(color = "gray90", linewidth = 1),
    panel.grid.minor = element_line(color = "gray90", linewidth = .5,
                                    linetype = "dashed"),
    panel.spacing = unit(base_size, "pt"),
    panel.spacing.x = NULL,
    panel.spacing.y = NULL,
    panel.ontop = FALSE,
    strip.background = element_rect(fill = "white", color = "gray30"),
    strip.text = element_text(color = "black", size = base_size),
    strip.text.x = element_text(margin = margin(t = half_line,
                                                b = half_line)),
    strip.text.y = element_text(angle = -90,
                                margin = margin(l = half_line,
                                                r = half_line)),
    strip.text.y.left = element_text(angle = 90),
    strip.placement = "inside",
    strip.placement.x = NULL,
    strip.placement.y = NULL,
    strip.switch.pad.grid = unit(0.1, "cm"),
    strip.switch.pad.wrap = unit(0.1, "cm"),
    plot.background = element_rect(color = NA),
    plot.title = element_text(size = base_size * 1.8, hjust = 0,
                              vjust = 1, face = "bold",
                              margin = margin(b = half_line/2)),
    plot.title.position = "plot",
    plot.subtitle = element_text(size = base_size * 1.3,
                                 hjust = 0, vjust = 1,
                                 margin = margin(b = half_line /2)),
    plot.caption = element_text(size = rel(0.9), hjust = 1, vjust = 1,
                                margin = margin(t = half_line * .9)),
    plot.caption.position = "plot",
    plot.tag = element_text(size = rel(1.2), hjust = .5, vjust = .5),
    plot.tag.position = "topleft",
    plot.margin = margin(20, 30, 20, 30),
    complete = TRUE
  )
}
colors<-c('#87CEEB', '#0D3B66', '#254441', '#DB504A', '#F5F4EF')
</script>
 
<script type="application/shiny-prerendered" data-context="data">

##
  health_board <- c(
    "Aneurin Bevan University Health Board",
    "Aneurin Bevan University Health Board",
    "Aneurin Bevan University Health Board",
    "Aneurin Bevan University Health Board",
    "Aneurin Bevan University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Cardiff and Vale University Health Board",
    "Cardiff and Vale University Health Board",
    "Cwm Taf Morgannwg University Health Board",
    "Cwm Taf Morgannwg University Health Board",
    "Cwm Taf Morgannwg University Health Board",
    "Hywel Dda University Health Board",
    "Hywel Dda University Health Board",
    "Hywel Dda University Health Board",
    "Powys Teaching Health Board",
    "Swansea Bay University Health Board",
    "Swansea Bay University Health Board"
  )
  
  area_served <- c(
    "Blaenau Gwent",
    "Caerphilly",
    "Monmouthshire",
    "Newport",
    "Torfaen",
    "Anglesey",
    "Gwynedd",
    "Conwy",
    "Denbighshire",
    "Flintshire",
    "Wrexham",
    "Cardiff",
    "Vale of Glamorgan",
    "Bridgend",
    "Merthyr Tydfil",
    "Rhondda Cynon Taf",
    "Carmarthenshire",
    "Ceredigion",
    "Pembrokeshire",
    "Powys",
    "Swansea",
    "Neath Port Talbot"
  )
  
# Create the data frame
welsh_health_boards <- data.frame(
    health_board = health_board,
    area_served = area_served)

##functions to get the data and partly clean them
get_data<-function(df){
  
  health_board <- c(
    "Aneurin Bevan University Health Board",
    "Aneurin Bevan University Health Board",
    "Aneurin Bevan University Health Board",
    "Aneurin Bevan University Health Board",
    "Aneurin Bevan University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Betsi Cadwaladr University Health Board",
    "Cardiff and Vale University Health Board",
    "Cardiff and Vale University Health Board",
    "Cwm Taf Morgannwg University Health Board",
    "Cwm Taf Morgannwg University Health Board",
    "Cwm Taf Morgannwg University Health Board",
    "Hywel Dda University Health Board",
    "Hywel Dda University Health Board",
    "Hywel Dda University Health Board",
    "Powys Teaching Health Board",
    "Swansea Bay University Health Board",
    "Swansea Bay University Health Board"
  )
  
  area_served <- c(
    "Blaenau Gwent",
    "Caerphilly",
    "Monmouthshire",
    "Newport",
    "Torfaen",
    "Anglesey",
    "Gwynedd",
    "Conwy",
    "Denbighshire",
    "Flintshire",
    "Wrexham",
    "Cardiff",
    "Vale of Glamorgan",
    "Bridgend",
    "Merthyr Tydfil",
    "Rhondda Cynon Taf",
    "Carmarthenshire",
    "Ceredigion",
    "Pembrokeshire",
    "Powys",
    "Swansea",
    "Neath Port Talbot"
  )
  
  # Create the data frame
  welsh_health_boards <- data.frame(
    health_board = health_board,
    area_served = area_served
  )
  
  main_df<-df|>rename(local_authority = "...2", 
                      local_auth_two = "...3",
                      Zero_to_fifteen =  "All ages...4",
                      sixteen_to_sixtyfour = "...5",
                      SixtyFive_and_over =  "...6" ,
                      Total = "All ages...7")|>
    select (local_authority:Total)|>
    slice(3:n())|>
    rowwise() %>%
    mutate(main_local = case_when(
      is.na(local_auth_two) & !is.na(local_authority) ~ local_authority,
      .default = str_trim(str_split(local_auth_two, 'U')[[1]][1])
    )) %>%
    
    mutate(main_local = case_when(
      main_local == "The Vale of Glamorgan" ~ "Vale of Glamorgan",
      main_local == "Isle of Anglesey" ~ 'Anglesey',
      main_local == "Rhondda Cynon Taff"  ~ "Rhondda Cynon Taf"  ,
      .default = main_local
    )) |>
    # Remove the rowwise structure
    ungroup() |>
    select (main_local, Zero_to_fifteen, sixteen_to_sixtyfour, SixtyFive_and_over, Total)|>
    group_by(main_local)|>
    summarise(
      Zero_to_fifteen = sum(as.numeric(Zero_to_fifteen)),
      sixteen_to_sixtyfour = sum(as.numeric(sixteen_to_sixtyfour)),
      SixtyFive_and_over = sum(as.numeric(SixtyFive_and_over)),
      Total = sum(as.numeric(Total))
    ) |>ungroup()|>
    left_join(welsh_health_boards, join_by(main_local == area_served))
  
  
  return(
    main_df
  )
}
get_data_from_nhs<-function(data_location, disease_source, res_or_provider){
  
  health_boards<-c("Aneurin Bevan ULHB", 
                   'Betsi Cadwaladr ULHB', 
                   'Cardiff & Vale ULHB',
                   'Cwm Taf Morgannwg ULHB',
                   'Hywel Dda ULHB',
                   'Powys Teaching LHB',
                   'Swansea Bay ULHB')
  combined_df <- map_dfr(health_boards,
                         ~ read_excel(data_location, sheet = .x, skip = 3) |>
    mutate(
      health_board = case_when(
        .x == "Cardiff & Vale ULHB" ~ str_replace(str_replace(.x, "&", "and"), "ULHB", "University Health Board"),
        .x == "Powys Teaching LHB" ~ str_replace(.x, "LHB", "Health Board"),
        TRUE ~ str_replace(.x, "ULHB", "University Health Board"))
                           
      ) |>replace_with_na_all(condition = ~.x %in% c('*', "**", "-")) |>
      mutate(disease_source = disease_source,
             resident_or_provider = res_or_provider)
  )
  
}


hb<-unique(health_board)
fem_pop<-get_data(read_excel("data/female.xlsx"))|>group_by(health_board)|>summarise(main_total_fem = sum(Total))
male_pop <- get_data(read_excel("data/males.xlsx"))|>group_by(health_board)|>summarise(main_total_male = sum(Total))
total_pop<-get_data(read_excel("data/total.xlsx"))|>group_by(health_board)|>summarise(main_total = sum(Total))

# test<-c("Aneurin Bevan ULHB", 'Betsi Cadwaladr ULHB', 'Cardiff & Vale ULHB','Cwm Taf Morgannwg ULHB','Hywel Dda ULHB',"Powys Teaching LHB",'Swansea Bay ULHB')

# combined_df <- map_dfr(
#   test,
#   ~ read_excel("data/ExcelTables11R_2023_LHB.xlsx", sheet = .x, skip = 3) |>
#     mutate(
#       health_board = case_when(
#         .x == "Cardiff & Vale ULHB" ~ str_replace(str_replace(.x, "&", "and"), "ULHB", "University Health Board"),
#         .x == "Powys Teaching LHB" ~ str_replace(.x, "LHB", "Health Board"),
#         TRUE ~ str_replace(.x, "ULHB", "University Health Board")
#       )|>
#     )
# )

disease_cat<-read.csv(here('data', 'main.csv'))
external_r<-get_data_from_nhs(here::here('data', "ExcelTables11R_2023_LHB.xlsx"), 'External', "Health board Resident")
external_p<-get_data_from_nhs(here('data', "ExcelTables11P_2023_LHB.xlsx"),  'External', "Health board Provider")
primary_r<-get_data_from_nhs(here::here('data', "ExcelTables3R_2023_LHB.xlsx"),  'Primary', "Health board Resident")
primary_p<-get_data_from_nhs(here::here('data', "ExcelTables3P_2023_LHB.xlsx"), 'Primary', "Health board Provider")

external_combined<-union(external_p, external_r)|>na.omit()|>mutate(disease = str_sub(Name, 1, 3))|>left_join(disease_cat, join_by(disease == Code))

primary_comb<-union(primary_p, primary_r)|>
  na.omit()|>
  mutate(disease = str_sub(Name, 1, 3))|>
  left_join(disease_cat, join_by(disease == Code))|>
  mutate( main_diag = case_when(
    is.na(DiagnosisType) & (lag(str_sub(disease, 1, 1)) == str_sub(disease, 1, 1) | lead(str_sub(disease, 1, 1)) == str_sub(disease, 1, 1)) ~ lag(DiagnosisType),
    .default = DiagnosisType))

df_prim<-primary_comb|>filter(str_detect(Name, 'Total'))|>left_join(total_pop, join_by(health_board == health_board))|>left_join(fem_pop, join_by(health_board == health_board))|>left_join(male_pop, join_by(health_board == health_board))
df_ex<-external_combined|>filter(str_detect(Name, 'Total'))|>left_join(total_pop, join_by(health_board == health_board))|>left_join(fem_pop, join_by(health_board == health_board))|>left_join(male_pop, join_by(health_board == health_board))


##
comp_ext<-df_ex|>
  mutate(
    fec_100 = round((as.numeric(`Finished Consultant Episodes`) / as.numeric(main_total)) * 10000, 2),
    admi_100 = round((as.numeric(Admissions) / as.numeric(main_total)) * 10000, 2),
    emergency_100 = round((as.numeric(Emergency) / as.numeric(main_total)) * 10000, 2),
    male_100 = round((as.numeric(Male) / as.numeric(main_total_male)) * 10000, 2),
    female_100 = round((as.numeric(Female) / as.numeric(main_total_fem)) * 10000, 2)
  )|>
  select(`Finished Consultant Episodes`, 
         Admissions, 
         Male, 
         Female, 
         Emergency, 
         health_board, 
         disease_source, 
         resident_or_provider, 
         fec_100,
         admi_100, 
         emergency_100, 
         male_100,
         female_100)

comp_prim<-df_prim|>
  mutate(
    fec_100 = round((as.numeric(`Finished Consultant Episodes`) / as.numeric(main_total)) * 10000, 2),
    admi_100 = round((as.numeric(Admissions) / as.numeric(main_total)) * 10000, 2),
    emergency_100 = round((as.numeric(Emergency) / as.numeric(main_total)) * 10000, 2),
    male_100 = round((as.numeric(Male) / as.numeric(main_total_male)) * 10000, 2),
    female_100 = round((as.numeric(Female) / as.numeric(main_total_fem)) * 10000, 2)
  )|>
  select(`Finished Consultant Episodes`, 
         Admissions, 
         Male, 
         Female, 
         Emergency, 
         health_board, 
         disease_source, 
         resident_or_provider, 
         fec_100,
         admi_100, 
         emergency_100, 
         male_100,
         female_100)


combined_100<-union(comp_ext, comp_prim)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
total_table <- reactive({
  if(input$Disease == "Primary"){
    df_prim|>filter(health_board == input$HealthBoard & resident_or_provider == input$RorP)
  }else{
    df_ex|>filter(health_board == input$HealthBoard & resident_or_provider == input$RorP)
  }
  
})


output$Admissions<-renderText(
  {sum(as.numeric(total_table()$Admissions))}
)

output$stay<-renderText(
  {round(sum(as.numeric(total_table()$`Mean Length of Stay`)), 2)}
)

output$cosult<-renderText(
  {sum(as.numeric(total_table()$`Finished Consultant Episodes`))}
)

output$emergency<-renderText(
  {sum(as.numeric(total_table()$Emergency))}
)

#for plots
total_table_plot_tot <- reactive({
  if(input$Disease == "Primary" & input$category != 'All'){
    primary_comb|>
    filter(health_board == input$HealthBoard & Name!='Total Episodes'& resident_or_provider == input$RorP &  DiagnosisType==input$category)|>select(Admissions, Name, Male, Female, `Age 0-14`, `Age 15-59`, `Age 60-74`, `Age 75+`)|>
      mutate(Admissions = as.numeric(Admissions),
             Male = as.numeric(Male),
             Female = as.numeric(Female),
             `Age 0-14` = as.numeric(`Age 0-14`),
             `Age 15-59` = as.numeric(`Age 15-59`),
             `Age 60-74` = as.numeric(`Age 60-74`),
             `Age 75+` = as.numeric(`Age 75+`),
             
             )|>
      arrange(desc(Admissions))|>
      slice(1:5)|>mutate(Name = factor(Name, levels = Name)) 
  }
  else if (input$Disease == "Primary" & input$category == 'All'){
    primary_comb|>
    filter(health_board == input$HealthBoard & Name!='Total Episodes'& resident_or_provider == input$RorP)|>
      select(Admissions, Name, Male, Female, `Age 0-14`, `Age 15-59`, `Age 60-74`, `Age 75+`)|>
      mutate(Admissions = as.numeric(Admissions),
             Male = as.numeric(Male),
             Female = as.numeric(Female),
             `Age 0-14` = as.numeric(`Age 0-14`),
             `Age 15-59` = as.numeric(`Age 15-59`),
             `Age 60-74` = as.numeric(`Age 60-74`),
             `Age 75+` = as.numeric(`Age 75+`),
             
             )|>
      arrange(desc(Admissions))|>
      slice(1:5)
  }
  else{
    external_combined|>
      filter(health_board == input$HealthBoard & Name!='Total External Causes' & resident_or_provider == input$RorP)|>
      select(Admissions, Name, Male, Female, `Age 0-14`, `Age 15-59`, `Age 60-74`, `Age 75+`)|>
      mutate(Admissions = as.numeric(Admissions),
             Male = as.numeric(Male),
             Female = as.numeric(Female),
             `Age 0-14` = as.numeric(`Age 0-14`),
             `Age 15-59` = as.numeric(`Age 15-59`),
             `Age 60-74` = as.numeric(`Age 60-74`),
             `Age 75+` = as.numeric(`Age 75+`),
             
             )|>      
      arrange(desc(Admissions))|>
      slice(1:5)
  }

})

output$top <- renderPlot({
  ggplot(total_table_plot_tot()) + 
  geom_bar(aes(x = reorder(Name, -Admissions), y= Admissions, fill = Name), stat = 'identity', width = 0.5) + 
  
  scale_fill_manual(values = colors) + 
  scale_y_continuous(breaks = seq(0, 6000, 500)) +
  theme_custom() + 
  theme(axis.text.x = element_blank(), 
        legend.text = element_text(size = 10,hjust = 0.5, lineheight = 121), legend.position = "bottom",
        legend.title = element_blank()) + 
  guides(fill = guide_legend(nrow = 3))
})

output$male <- renderPlot({
  ggplot(total_table_plot_tot()) + 
  geom_bar(aes(x = reorder(Name, -Male), y= Male, fill = Name), stat = 'identity', width = 0.5) + 
  
  scale_fill_manual(values = colors) + 
  scale_y_continuous(breaks = seq(0, 3000, 500)) +
  theme_custom() + 
  theme(axis.text.x = element_blank(), 
        legend.text = element_text(size = 10,hjust = 0.5, lineheight = 121), legend.position = "bottom",
        legend.title = element_blank()) + 
  guides(fill = guide_legend(nrow = 3))
})

output$female <- renderPlot({
  ggplot(total_table_plot_tot()) + 
  geom_bar(aes(x = reorder(Name, -Female), y= Female, fill = Name), stat = 'identity', width = 0.5) + 
  
  scale_fill_manual(values = colors) + 
  scale_y_continuous(breaks = seq(0, 3000, 500)) +
  theme_custom() + 
  theme(axis.text.x = element_blank(), 
        legend.text = element_text(size = 10,hjust = 0.5, lineheight = 121), legend.position = "bottom",
        legend.title = element_blank()) + 
  guides(fill = guide_legend(nrow = 3))
})


output$fourteen <- renderPlot({
  ggplot(total_table_plot_tot()) + 
  geom_bar(aes(x = reorder(Name, -`Age 0-14`), y= `Age 0-14`, fill = Name), stat = 'identity', width = 0.5) + 
  
  scale_fill_manual(values = colors) + 
  scale_y_continuous(breaks = seq(0, 3000, 500)) +
  theme_custom() + 
  theme(axis.text.x = element_blank(), 
        legend.text = element_text(size = 10,hjust = 0.5, lineheight = 121), legend.position = "bottom",
        legend.title = element_blank()) + 
  guides(fill = guide_legend(nrow = 3))
})

output$fifteen <- renderPlot({
  ggplot(total_table_plot_tot()) + 
  geom_bar(aes(x = reorder(Name, -`Age 15-59`), y= `Age 15-59`, fill = Name), stat = 'identity', width = 0.5) + 
  
  scale_fill_manual(values = colors) + 
  scale_y_continuous(breaks = seq(0, 3000, 500)) +
  theme_custom() + 
  theme(axis.text.x = element_blank(), 
        legend.text = element_text(size = 10,hjust = 0.5, lineheight = 121), legend.position = "bottom",
        legend.title = element_blank()) + 
  guides(fill = guide_legend(nrow = 3))
})

output$sixty <- renderPlot({
  ggplot(total_table_plot_tot()) + 
  geom_bar(aes(x = reorder(Name, -`Age 60-74`), y= `Age 60-74`, fill = Name), stat = 'identity', width = 0.5) + 
  
  scale_fill_manual(values = colors) + 
  scale_y_continuous(breaks = seq(0, 3000, 500)) +
  theme_custom() + 
  theme(axis.text.x = element_blank(), 
        legend.text = element_text(size = 10,hjust = 0.5, lineheight = 121), legend.position = "bottom",
        legend.title = element_blank()) + 
  guides(fill = guide_legend(nrow = 3))
})

output$sevenfive <- renderPlot({
  ggplot(total_table_plot_tot()) + 
  geom_bar(aes(x = reorder(Name, -`Age 75+`), y= `Age 75+`, fill = Name), stat = 'identity', width = 0.5) + 
  
  scale_fill_manual(values = colors) + 
  scale_y_continuous(breaks = seq(0, 3000, 500)) +
  theme_custom() + 
  theme(axis.text.x = element_blank(), 
        legend.text = element_text(size = 10,hjust = 0.5, lineheight = 121), legend.position = "bottom",
        legend.title = element_blank()) + 
  guides(fill = guide_legend(nrow = 3))
})

# observeEvent(input$Disease, {
#   if (input$Disease == "Internal") {
#     updateSelectInput(
#       session,
#       inputId = "category",
#       label = "Category of internal disease",
#       choices = c("All", unique(primary_comb$DiagnosisType))
#     )
#   } else if (input$Disease == "External") {
#     updateSelectInput(
#       session,
#       inputId = "category",
#       label = "Category of internal disease",
#       choices = NULL
#     )
#   }
# })


###page 2
##get the long data

long<- reactive({
  left_filters<-combined_100|>
    filter(health_board == input$HealthBoard & disease_source == input$Disease & resident_or_provider == input$RorP)|>
    select(-c(disease_source, resident_or_provider, health_board))|>
    mutate_all(function(x) as.numeric(as.character(x)))|>
    pivot_longer(everything(),names_to = 'metric', values_to = 'value')|>mutate(name = "Left")
  
  right_filters<-combined_100|>
    filter(health_board == input$HealthBoardtwo & disease_source == input$Diseasetwo & resident_or_provider == input$RorPtwo)|>
    select(-c(disease_source, resident_or_provider, health_board))|>
    mutate_all(function(x) as.numeric(as.character(x)))|>
    pivot_longer(everything(),names_to = 'metric', values_to = 'value')|>mutate(name = "Right")
  
  long<-union(left_filters, right_filters)
  
  long$metric<-factor(long$metric, levels = c("Finished Consultant Episodes", "fec_100", "Admissions" , "admi_100", "Emergency", 
                                              "emergency_100" , "Female" , "female_100", "Male","male_100" ))
  
  long
  
})

long_main<-reactive(
  {
    long()|>pivot_wider(names_from = name, values_from = value)|>
      mutate(dif = Left - Right)|>
      group_by(metric)|>
      mutate(max = max(Left, Right))|>
      ungroup()|>
      pivot_longer(c(Left, Right))
  }
)

wide<-reactive(
  {
   long()|>
      pivot_wider(names_from = name, values_from = value)|>
      mutate(dif = Left - Right)|>
      group_by(metric)|>
      mutate(max = max(Left, Right))|>
      ungroup()
  }
)


output$comparison <- renderPlot({

  df_main <- long_main()

  df_main <- df_main |>
    mutate(
      nudge_x = ifelse(value == max, 0.6, -0.6),
      vjust_pos = ifelse(value == max, -0.9, 2)
    )

  p_main <- ggplot(df_main, aes(x = value, y = metric)) +
    geom_line(aes(group = metric), color = "#E7E7E7", linewidth = 3.5) +
    geom_point(aes(color = name), size = 3) +
    geom_text(aes(label = value, color = name, 
                  nudge_x = nudge_x, vjust = vjust_pos), size = 5) +
    theme_custom() +
    theme(
      legend.position = "none",
      axis.text.y = element_text(color = "black", margin = margin(r = 15)),
      axis.text.x = element_text(color = "#989898"),
      axis.title = element_blank()
    ) +
    scale_color_manual(values = c("#436685", "#BF2F24")) +
    scale_y_discrete(
      limits = rev(levels(long()$metric)),
      labels = c(
        "fec_100" = "Finished Consultant Episodes per 10000",
        "admi_100" = "Admissions per 10000", 
        "emergency_100" = "Emergency per 10000",
        "male_100" = "Male Admissions per 10000",
        "female_100" = "Female Admissions per 10000"
      )
    )

  p_gap <- wide() |>
    ggplot(aes(x = dif, y = metric)) + 
    geom_text(aes(x = 0, label = dif), fontface = "bold", size = 5) +
    geom_text(aes(x = 0, y = 10), label = "Difference", nudge_y = 0.5,
              fontface = "bold", size = 5) +
    scale_y_discrete(limits = rev(levels(wide()$metric))) + 
    theme_void() +
    coord_cartesian(xlim = c(-0.05, 0.05)) +
    theme(
      plot.margin = margin(l = 0, r = 0, b = 0, t = 0),
      panel.background = element_rect(fill = "#EFEFE3", color = "#EFEFE3"),
      legend.position = "none"
    )

  p_main + p_gap + patchwork::plot_layout(
    design = c(
      patchwork::area(l = 0,  r = 45, t = 0, b = 1),
      patchwork::area(l = 46, r = 52, t = 0, b = 1)
    )
  )
})






</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-component-js"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components/dist"]}]},{"type":"NULL"},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["src"]}},"value":[{"type":"character","attributes":{},"value":["components.min.js"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["src","type"]}},"value":[{"type":"character","attributes":{},"value":["web-components.min.js"]},{"type":"character","attributes":{},"value":["module"]}]}]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-component-css"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components/dist"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["components.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-tag-require"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tag-require.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-component-js"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components/dist"]}]},{"type":"NULL"},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["src"]}},"value":[{"type":"character","attributes":{},"value":["components.min.js"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["src","type"]}},"value":[{"type":"character","attributes":{},"value":["web-components.min.js"]},{"type":"character","attributes":{},"value":["module"]}]}]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-component-css"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components/dist"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["components.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-tag-require"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tag-require.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-component-js"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components/dist"]}]},{"type":"NULL"},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["src"]}},"value":[{"type":"character","attributes":{},"value":["components.min.js"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["src","type"]}},"value":[{"type":"character","attributes":{},"value":["web-components.min.js"]},{"type":"character","attributes":{},"value":["module"]}]}]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-component-css"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components/dist"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["components.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-tag-require"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tag-require.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-component-js"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components/dist"]}]},{"type":"NULL"},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["src"]}},"value":[{"type":"character","attributes":{},"value":["components.min.js"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["src","type"]}},"value":[{"type":"character","attributes":{},"value":["web-components.min.js"]},{"type":"character","attributes":{},"value":["module"]}]}]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-component-css"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components/dist"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["components.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bslib-tag-require"]},{"type":"character","attributes":{},"value":["0.8.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["components"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tag-require.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["bslib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78]}},"value":[{"type":"character","attributes":{},"value":["base","bsicons","bslib","cachem","cellranger","cli","colorspace","compiler","datasets","digest","dplyr","DT","evaluate","fansi","farver","fastmap","forcats","generics","ggplot2","glue","graphics","grDevices","grid","gt","gtable","here","hms","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","knitr","later","lifecycle","lubridate","magrittr","memoise","methods","mime","munsell","naniar","patchwork","pillar","pkgconfig","promises","purrr","R6","Rcpp","readr","readxl","rlang","rmarkdown","rprojroot","rstudioapi","sass","scales","shiny","shinyWidgets","stats","stringi","stringr","tibble","tidyr","tidyselect","tidyverse","timechange","tools","tzdb","utf8","utils","vctrs","visdat","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["4.3.2","0.1.2","0.8.0","1.1.0","1.1.0","3.6.2","2.1-0","4.3.2","4.3.2","0.6.35","1.1.4","0.33","1.0.1","1.0.6","2.1.1","1.2.0","1.0.0","0.1.3","3.5.0","1.8.0","4.3.2","4.3.2","4.3.2","0.11.0","0.3.5","1.0.1","1.1.3","0.5.8","1.6.4","1.6.15","0.1.4","1.8.9","1.49","1.4.1","1.0.4","1.9.3","2.0.3","2.0.1","4.3.2","0.12","0.5.1","1.1.0","1.3.0","1.9.0","2.0.3","1.3.2","1.0.2","2.5.1","1.0.13-1","2.1.5","1.4.3","1.1.3","2.29","2.0.4","0.16.0","0.4.9","1.3.0","1.10.0","0.9.0","4.3.2","1.8.3","1.5.1","3.2.1","1.3.1","1.2.1","2.0.0","0.3.0","4.3.2","0.4.0","1.2.4","4.3.2","0.6.5","0.6.0","3.0.2","0.49","1.3.6","1.8-4","2.3.8"]}]}]}
</script>
<!--/html_preserve-->


<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /container fluid -->

<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (_event) {
  if (window.bslib.Card) {
    window.bslib.Card.initializeAllCards();
  }
}); 
</script>
  



</body></html>